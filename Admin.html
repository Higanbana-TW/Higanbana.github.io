<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡å¯©æ ¸ / å½¼å²¸èŠ±ï¼›é–‹å½¼å²¸ã€‚</title>
    <style>
        @import url('https://fonts.googleapis.com/earlyaccess/cwtexming.css');
        body {
            font-family: 'cwTeXMing', 'Arial', serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .admin-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            color: rgba(199, 118, 131, 0.986);
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h3 {
            color: #333;
            margin-top: 0;
        }
        .member-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .member-card {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }
        .member-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .member-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-approve {
            background-color: #4CAF50;
            color: white;
        }
        .btn-reject {
            background-color: #f44336;
            color: white;
        }
        .btn-remove {
            background-color: #ff9800;
            color: white;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            flex: 1;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        .no-members {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        /* å°èˆªæ¬„æ¨£å¼ */
        .navbar {
            background-color: #444;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .navbar ul {
            list-style-type: none;
            margin: 0;
            padding: 10px 0;
        }
        .navbar ul > li {
            display: inline-block;
            margin: 0 10px;
        }
        .navbar ul > li > a {
            display: block;
            text-decoration: none;
            color: #fff;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .navbar a:hover {
            background-color: #666;
            color: rgb(248, 161, 161);
        }
        .navbar .active {
            color: rgb(250, 136, 136);
        }
    </style>
</head>

<body>
    <!-- å°èˆªæ¬„ -->
    <div class="navbar">
        <ul>
            <li><a href="./Home.html">Home</a></li>
        </ul>
    </div>

    <div class="admin-container">
        <h1>ğŸ›ï¸ å…¬æœƒç®¡ç†å“¡å¯©æ ¸ä¸­å¿ƒ</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">å¾…å¯©æ ¸ç”³è«‹</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedCount">0</div>
                <div class="stat-label">å·²å¯©æ ¸æˆå“¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="guestCount">0</div>
                <div class="stat-label">è¨»å†Šè¨ªå®¢</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="commentCount">0</div>
                <div class="stat-label">ç¸½ç•™è¨€æ•¸</div>
            </div>
        </div>
        
        <div class="section">
            <h3>â³ å¾…å¯©æ ¸ç”³è«‹</h3>
            <div id="pendingMembers" class="member-list">
                <div class="no-members">ç›®å‰æ²’æœ‰å¾…å¯©æ ¸çš„ç”³è«‹</div>
            </div>
        </div>
        
        <div class="section">
            <h3>âœ… å·²å¯©æ ¸æˆå“¡</h3>
            <div id="approvedMembers" class="member-list">
                <div class="no-members">ç›®å‰æ²’æœ‰å·²å¯©æ ¸çš„æˆå“¡</div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ‘¤ è¨»å†Šè¨ªå®¢</h3>
            <div id="guestMembers" class="member-list">
                <div class="no-members">ç›®å‰æ²’æœ‰è¨»å†Šçš„è¨ªå®¢</div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ’¬ ç•™è¨€ç®¡ç†</h3>
            <div style="margin-bottom: 20px;">
                <button onclick="loadAllComments()" class="btn btn-approve" style="margin-right: 10px;">åˆ·æ–°ç•™è¨€</button>
                <button onclick="clearAllComments()" class="btn btn-remove">æ¸…ç©ºæ‰€æœ‰ç•™è¨€</button>
            </div>
            <div id="commentsManagement" class="member-list">
                <div class="no-members">é»æ“Šã€Œåˆ·æ–°ç•™è¨€ã€è¼‰å…¥æ‰€æœ‰æ´»å‹•ç•™è¨€</div>
            </div>
        </div>
    </div>

    <script>
        // è¼‰å…¥æ‰€æœ‰æ•¸æ“š
        function loadAllData() {
            loadPendingMembers();
            loadApprovedMembers();
            loadGuestMembers();
            updateStats();
        }
        
        // è¼‰å…¥å¾…å¯©æ ¸æˆå“¡
        function loadPendingMembers() {
            const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
            const container = document.getElementById('pendingMembers');
            
            if (pendingMembers.length === 0) {
                container.innerHTML = '<div class="no-members">ç›®å‰æ²’æœ‰å¾…å¯©æ ¸çš„ç”³è«‹</div>';
                return;
            }
            
            container.innerHTML = pendingMembers.map(member => `
                <div class="member-card">
                    <div class="member-name">${escapeHtml(member)}</div>
                    <div class="member-actions">
                        <button class="btn btn-approve" onclick="approveMember('${escapeHtml(member)}')">é€šé</button>
                        <button class="btn btn-reject" onclick="rejectMember('${escapeHtml(member)}')">æ‹’çµ•</button>
                    </div>
                </div>
            `).join('');
        }
        
        // è¼‰å…¥å·²å¯©æ ¸æˆå“¡
        function loadApprovedMembers() {
            const approvedMembers = JSON.parse(localStorage.getItem('registeredMembers') || '[]');
            const container = document.getElementById('approvedMembers');
            
            if (approvedMembers.length === 0) {
                container.innerHTML = '<div class="no-members">ç›®å‰æ²’æœ‰å·²å¯©æ ¸çš„æˆå“¡</div>';
                return;
            }
            
            container.innerHTML = approvedMembers.map(member => `
                <div class="member-card">
                    <div class="member-name">${escapeHtml(member)}</div>
                    <div class="member-actions">
                        <button class="btn btn-remove" onclick="removeMember('${escapeHtml(member)}')">ç§»é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // è¼‰å…¥è¨ªå®¢æˆå“¡
        function loadGuestMembers() {
            const guestMembers = JSON.parse(localStorage.getItem('guestbookMembers') || '[]');
            const container = document.getElementById('guestMembers');
            
            if (guestMembers.length === 0) {
                container.innerHTML = '<div class="no-members">ç›®å‰æ²’æœ‰è¨»å†Šçš„è¨ªå®¢</div>';
                return;
            }
            
            container.innerHTML = guestMembers.map(member => `
                <div class="member-card">
                    <div class="member-name">${escapeHtml(member)}</div>
                    <div class="member-actions">
                        <button class="btn btn-approve" onclick="promoteGuest('${escapeHtml(member)}')">æå‡ç‚ºæˆå“¡</button>
                        <button class="btn btn-remove" onclick="removeGuest('${escapeHtml(member)}')">ç§»é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
            const approvedMembers = JSON.parse(localStorage.getItem('registeredMembers') || '[]');
            const guestMembers = JSON.parse(localStorage.getItem('guestbookMembers') || '[]');
            
            document.getElementById('pendingCount').textContent = pendingMembers.length;
            document.getElementById('approvedCount').textContent = approvedMembers.length;
            document.getElementById('guestCount').textContent = guestMembers.length;
            
            // è¨ˆç®—ç¸½ç•™è¨€æ•¸
            const totalComments = getAllCommentsCount();
            document.getElementById('commentCount').textContent = totalComments;
        }
        
        // ç²å–æ‰€æœ‰ç•™è¨€çš„ç¸½æ•¸
        function getAllCommentsCount() {
            const commentKeys = [
                'sakuraComments', 'anniversary9Comments', 'gamblingComments', 'qaComments', 
                'recruitComments', 'bossComments', 'gambling6Comments', 'qa6Comments', 
                'lottery6Comments', 'minecart6Comments', 'forget2020Comments', 
                'anniversary7Comments', 'spring2022Comments', 'christmas2021Comments', 
                'anniversary4Comments', 'award4Comments', 'forget2020_1Comments', 
                'forget2020_2Comments', 'forget2020_3Comments'
            ];
            
            let totalCount = 0;
            commentKeys.forEach(key => {
                const comments = JSON.parse(localStorage.getItem(key) || '[]');
                totalCount += comments.length;
            });
            return totalCount;
        }
        
        // è¼‰å…¥æ‰€æœ‰ç•™è¨€
        function loadAllComments() {
            const commentKeys = [
                {key: 'sakuraComments', name: '2024è–©æº«ç¯€'},
                {key: 'anniversary9Comments', name: '2024ä¹é€±å¹´æ´»å‹•å…¬å‘Š'},
                {key: 'gamblingComments', name: '2024ä¹é€±å¹´è³­èˆ¹'},
                {key: 'qaComments', name: '2024ä¹é€±å¹´QAå•ç­”'},
                {key: 'recruitComments', name: '2024ä¹é€±å¹´æ–°å…µ'},
                {key: 'bossComments', name: '2024ä¹é€±å¹´å¤§ä½¬'},
                {key: 'gambling6Comments', name: '2021å…­é€±å¹´è³­èˆ¹'},
                {key: 'qa6Comments', name: '2021å…­é€±å¹´QAå•ç­”'},
                {key: 'lottery6Comments', name: '2021å…­é€±å¹´æŠ½ç'},
                {key: 'minecart6Comments', name: '2021å…­é€±å¹´ç¤¦è»Š'},
                {key: 'forget2020Comments', name: '2020å¿˜å¹´æ´»å‹•å…¬å‘Š'},
                {key: 'anniversary7Comments', name: 'ä¸ƒé€±å¹´æ´»å‹•'},
                {key: 'spring2022Comments', name: '2022æ˜¥å­£æ´»å‹•'},
                {key: 'christmas2021Comments', name: '2021è–èª•æ´»å‹•'},
                {key: 'anniversary4Comments', name: '2019å››é€±å¹´æ´»å‹•'},
                {key: 'award4Comments', name: '2019å››é€±å¹´å¾—ç'},
                {key: 'forget2020_1Comments', name: '2020å¿˜å¹´æ´»å‹•ä¸€'},
                {key: 'forget2020_2Comments', name: '2020å¿˜å¹´æ´»å‹•äºŒ'},
                {key: 'forget2020_3Comments', name: '2020å¿˜å¹´æ´»å‹•ä¸‰'}
            ];
            
            const container = document.getElementById('commentsManagement');
            let allComments = [];
            
            // æ”¶é›†æ‰€æœ‰ç•™è¨€
            commentKeys.forEach(item => {
                const comments = JSON.parse(localStorage.getItem(item.key) || '[]');
                comments.forEach(comment => {
                    allComments.push({
                        ...comment,
                        activityName: item.name,
                        storageKey: item.key
                    });
                });
            });
            
            // æŒ‰æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            allComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (allComments.length === 0) {
                container.innerHTML = '<div class="no-members">ç›®å‰æ²’æœ‰ä»»ä½•ç•™è¨€</div>';
                return;
            }
            
            container.innerHTML = allComments.map(comment => `
                <div class="member-card" style="margin-bottom: 15px;">
                    <div style="font-weight: bold; color: #333; margin-bottom: 8px;">
                        ${escapeHtml(comment.user)} 
                        <span style="font-size: 12px; color: #999; font-weight: normal;">${comment.timestamp}</span>
                    </div>
                    <div style="color: #666; font-size: 12px; margin-bottom: 8px;">
                        æ´»å‹•ï¼š${escapeHtml(comment.activityName)}
                    </div>
                    <div style="color: #333; line-height: 1.5; margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 5px;">
                        ${escapeHtml(comment.text)}
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-remove" onclick="deleteComment('${comment.storageKey}', '${escapeHtml(comment.user)}', '${escapeHtml(comment.timestamp)}')">åˆªé™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // åˆªé™¤å–®å€‹ç•™è¨€
        function deleteComment(storageKey, userName, timestamp) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ${userName} åœ¨ ${timestamp} çš„ç•™è¨€å—ï¼Ÿ`)) {
                const comments = JSON.parse(localStorage.getItem(storageKey) || '[]');
                const updatedComments = comments.filter(comment => 
                    !(comment.user === userName && comment.timestamp === timestamp)
                );
                localStorage.setItem(storageKey, JSON.stringify(updatedComments));
                
                // é‡æ–°è¼‰å…¥ç•™è¨€
                loadAllComments();
                updateStats();
                alert('ç•™è¨€å·²åˆªé™¤ï¼');
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰ç•™è¨€
        function clearAllComments() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ´»å‹•çš„ç•™è¨€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                const commentKeys = [
                    'sakuraComments', 'anniversary9Comments', 'gamblingComments', 'qaComments', 
                    'recruitComments', 'bossComments', 'gambling6Comments', 'qa6Comments', 
                    'lottery6Comments', 'minecart6Comments', 'forget2020Comments', 
                    'anniversary7Comments', 'spring2022Comments', 'christmas2021Comments', 
                    'anniversary4Comments', 'award4Comments', 'forget2020_1Comments', 
                    'forget2020_2Comments', 'forget2020_3Comments'
                ];
                
                commentKeys.forEach(key => {
                    localStorage.setItem(key, JSON.stringify([]));
                });
                
                loadAllComments();
                updateStats();
                alert('æ‰€æœ‰ç•™è¨€å·²æ¸…ç©ºï¼');
            }
        }
        
        // é€šéæˆå“¡ç”³è«‹
        function approveMember(memberName) {
            if (confirm(`ç¢ºå®šè¦é€šé ${memberName} çš„ç”³è«‹å—ï¼Ÿ`)) {
                // å¾å¾…å¯©æ ¸åå–®ç§»é™¤
                const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
                const updatedPending = pendingMembers.filter(name => name !== memberName);
                localStorage.setItem('pendingMembers', JSON.stringify(updatedPending));
                
                // åŠ å…¥å·²å¯©æ ¸åå–®
                const approvedMembers = JSON.parse(localStorage.getItem('registeredMembers') || '[]');
                if (!approvedMembers.includes(memberName)) {
                    approvedMembers.push(memberName);
                    localStorage.setItem('registeredMembers', JSON.stringify(approvedMembers));
                }
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                loadAllData();
                alert(`${memberName} çš„ç”³è«‹å·²é€šéï¼`);
            }
        }
        
        // æ‹’çµ•æˆå“¡ç”³è«‹
        function rejectMember(memberName) {
            if (confirm(`ç¢ºå®šè¦æ‹’çµ• ${memberName} çš„ç”³è«‹å—ï¼Ÿ`)) {
                // å¾å¾…å¯©æ ¸åå–®ç§»é™¤
                const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
                const updatedPending = pendingMembers.filter(name => name !== memberName);
                localStorage.setItem('pendingMembers', JSON.stringify(updatedPending));
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                loadAllData();
                alert(`${memberName} çš„ç”³è«‹å·²æ‹’çµ•ï¼`);
            }
        }
        
        // ç§»é™¤æˆå“¡
        function removeMember(memberName) {
            if (confirm(`ç¢ºå®šè¦ç§»é™¤ ${memberName} çš„æˆå“¡è³‡æ ¼å—ï¼Ÿ`)) {
                // å¾å·²å¯©æ ¸åå–®ç§»é™¤
                const approvedMembers = JSON.parse(localStorage.getItem('registeredMembers') || '[]');
                const updatedApproved = approvedMembers.filter(name => name !== memberName);
                localStorage.setItem('registeredMembers', JSON.stringify(updatedApproved));
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                loadAllData();
                alert(`${memberName} çš„æˆå“¡è³‡æ ¼å·²ç§»é™¤ï¼`);
            }
        }
        
        // æå‡è¨ªå®¢ç‚ºæˆå“¡
        function promoteGuest(guestName) {
            if (confirm(`ç¢ºå®šè¦å°‡ ${guestName} æå‡ç‚ºå…¬æœƒæˆå“¡å—ï¼Ÿ`)) {
                // å¾è¨ªå®¢åå–®ç§»é™¤
                const guestMembers = JSON.parse(localStorage.getItem('guestbookMembers') || '[]');
                const updatedGuests = guestMembers.filter(name => name !== guestName);
                localStorage.setItem('guestbookMembers', JSON.stringify(updatedGuests));
                
                // åŠ å…¥å·²å¯©æ ¸æˆå“¡åå–®
                const approvedMembers = JSON.parse(localStorage.getItem('registeredMembers') || '[]');
                if (!approvedMembers.includes(guestName)) {
                    approvedMembers.push(guestName);
                    localStorage.setItem('registeredMembers', JSON.stringify(approvedMembers));
                }
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                loadAllData();
                alert(`${guestName} å·²æå‡ç‚ºå…¬æœƒæˆå“¡ï¼`);
            }
        }
        
        // ç§»é™¤è¨ªå®¢
        function removeGuest(guestName) {
            if (confirm(`ç¢ºå®šè¦ç§»é™¤ ${guestName} çš„è¨ªå®¢è³‡æ ¼å—ï¼Ÿ`)) {
                // å¾è¨ªå®¢åå–®ç§»é™¤
                const guestMembers = JSON.parse(localStorage.getItem('guestbookMembers') || '[]');
                const updatedGuests = guestMembers.filter(name => name !== guestName);
                localStorage.setItem('guestbookMembers', JSON.stringify(updatedGuests));
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                loadAllData();
                alert(`${guestName} çš„è¨ªå®¢è³‡æ ¼å·²ç§»é™¤ï¼`);
            }
        }
        
        // HTML è½‰ç¾©å‡½æ•¸
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // é é¢è¼‰å…¥æ™‚è¼‰å…¥æ‰€æœ‰æ•¸æ“š
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });
    </script>
</body>

</html>
